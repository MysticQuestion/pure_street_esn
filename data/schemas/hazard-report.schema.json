{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://esn.purestreet.io/schemas/hazard-report.schema.json",
  "title": "ESN Hazard Report",
  "description": "Schema defining the structure of a hazard report submitted through ESN.",
  "type": "object",
  "required": [
    "report_id",
    "reporter_id",
    "source_type",
    "category_id",
    "location",
    "observed_at",
    "submitted_at",
    "verification_status"
  ],
  "properties": {
    "report_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the hazard report."
    },
    "reporter_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier of the user or sensor submitting the report."
    },
    "source_type": {
      "type": "string",
      "enum": ["resident", "crew", "partner", "sensor", "imported_311"],
      "description": "Classification of the reporting entity."
    },
    "category_id": {
      "type": "string",
      "pattern": "^[A-Z]+_[0-9]{2}$",
      "description": "Identifier referencing a hazard category defined in the taxonomy."
    },
    "subcategory_tag": {
      "type": ["string", "null"],
      "maxLength": 100,
      "description": "Optional tag indicating a subcategory or specific material."
    },
    "description": {
      "type": ["string", "null"],
      "maxLength": 2000,
      "description": "Free text description provided by the reporter."
    },
    "severity_raw": {
      "type": ["integer", "null"],
      "minimum": 1,
      "maximum": 5,
      "description": "Raw severity rating provided by the reporter (1â€“5)."
    },
    "location": {
      "type": "object",
      "required": ["lat", "lng"],
      "properties": {
        "lat": { "type": "number", "minimum": -90, "maximum": 90 },
        "lng": { "type": "number", "minimum": -180, "maximum": 180 },
        "accuracy_meters": { "type": ["number", "null"], "minimum": 0 },
        "geohash": { "type": ["string", "null"] },
        "corridor_id": { "type": ["string", "null"], "maxLength": 128 },
        "blockface_id": { "type": ["string", "null"], "maxLength": 128 }
      },
      "additionalProperties": false
    },
    "attachments": {
      "type": "array",
      "description": "List of media attachments associated with the report.",
      "items": {
        "type": "object",
        "required": ["attachment_id", "kind", "uri"],
        "properties": {
          "attachment_id": { "type": "string", "format": "uuid" },
          "kind": { "type": "string", "enum": ["photo", "video", "audio"] },
          "uri": { "type": "string", "format": "uri" },
          "thumbnail_uri": { "type": ["string", "null"], "format": "uri" },
          "sha256": { "type": ["string", "null"], "description": "Checksum of the attachment." },
          "exif": {
            "type": ["object", "null"],
            "properties": {
              "captured_at": { "type": ["string", "null"], "format": "date-time" },
              "lat": { "type": ["number", "null"] },
              "lng": { "type": ["number", "null"] },
              "device_make": { "type": ["string", "null"] },
              "device_model": { "type": ["string", "null"] }
            },
            "additionalProperties": true
          }
        },
        "additionalProperties": false
      }
    },
    "observed_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the hazard was observed."
    },
    "submitted_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the report was submitted to ESN."
    },
    "verification_status": {
      "type": "string",
      "enum": [
        "pending", "auto_verified", "verified", "rejected", "duplicate_merged",
        "resolved", "closed_unresolved"
      ],
      "description": "Current verification state of the report."
    },
    "verification_confidence": {
      "type": ["number", "null"],
      "minimum": 0,
      "maximum": 1,
      "description": "Numeric confidence in the correctness of the report after verification."
    },
    "duplicate_of_report_id": {
      "type": ["string", "null"],
      "format": "uuid",
      "description": "Identifier of the report this entry is considered a duplicate of, if any."
    },
    "trust_score_snapshot": {
      "type": ["number", "null"],
      "minimum": 0,
      "maximum": 1,
      "description": "Reporter trust score at the time of submission."
    },
    "routing_targets": {
      "type": "array",
      "description": "List of target systems or partners for routing this report.",
      "items": { "type": "string", "maxLength": 100 }
    },
    "privacy_flags": {
      "type": "object",
      "description": "Flags indicating the presence of sensitive content requiring redaction.",
      "properties": {
        "contains_faces": { "type": "boolean" },
        "contains_license_plate": { "type": "boolean" },
        "contains_minors": { "type": "boolean" },
        "redaction_required": { "type": "boolean" }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}